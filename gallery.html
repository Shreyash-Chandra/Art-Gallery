<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Online Art Gallery</title>
  <style>
    body {
      background-color: black;
      padding: 100px 50px;
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      animation: fadeIn 1s ease;
    }
    .gallery-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      position: relative;
    }
    .image-wrapper {
        position: relative;
        animation: popIn 0.5s ease forwards;
    }
    .gallery-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
      transition: transform 0.4s ease, box-shadow 0.4s ease, border 0.4s ease;
      cursor: pointer;
      border: 3px solid transparent;
    }
    .gallery-container img:hover {
      transform: scale(1.08);
      box-shadow: 0 0 15px #95c11e;
      border: 3px solid #95c11e;
      z-index: 10;
    }
    .fullscreen-overlay {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0, 0, 0, 0.95);
      display: none; justify-content: center; align-items: center;
      z-index: 9999;
      animation: fadeIn 0.4s ease forwards;
    }
    .fullscreen-overlay img {
      max-width: 90%; max-height: 90%;
      border-radius: 12px; box-shadow: 0 0 30px #95c11e;
      border: 4px solid #95c11e;
      animation: zoomIn 0.4s ease;
    }
    .fullscreen-overlay.active { display: flex; }
    .upload-box {
      display: flex; justify-content: center; align-items: center;
      background-color: #111; border-radius: 10px;
      aspect-ratio: 1/1; /* Makes the box square */
      cursor: pointer; position: relative;
      border: 3px dashed #333;
      transition: 0.3s ease;
      animation: popIn 0.5s ease forwards;
    }
    .upload-box:hover {
      box-shadow: 0 0 15px #95c11e;
      border: 3px solid #95c11e;
    }
    .upload-box span { font-size: 48px; color: #95c11e; }
    .delete-btn {
      position: absolute; top: 8px; right: 8px;
      background-color: #ff4757; border: none;
      color: white; font-size: 14px; font-weight: bold;
      cursor: pointer; border-radius: 50%;
      width: 25px; height: 25px; z-index: 20;
      display: flex; justify-content: center; align-items: center;
      opacity: 0; transition: opacity 0.3s ease;
    }
    .image-wrapper:hover .delete-btn { opacity: 1; }
    .admin-login {
      position: fixed; top: 20px; right: 20px;
      background: #111; border: 2px solid #95c11e;
      border-radius: 8px; padding: 10px; z-index: 10000;
    }
    .admin-login input {
      background: black; border: 1px solid #95c11e; color: white;
      padding: 5px; border-radius: 4px;
    }
    .admin-login button {
        background: #95c11e; border: none; color: black;
        padding: 5px 10px; border-radius: 4px; cursor: pointer;
    }
    @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes zoomIn { from { transform: scale(0.6); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  </style>
</head>
<body>

  <div class="admin-login">
    <input type="password" id="adminPass" placeholder="Admin Password">
    <button onclick="checkPassword()">Login</button>
  </div>

  <div class="gallery-container" id="gallery"></div>

  <div class="fullscreen-overlay" id="fullscreenOverlay">
    <img id="fullscreenImage" src="" alt="Full Screen View" />
  </div>

  <script>
    // --- PART 1: CONFIGURATION ---
    // PASTE YOUR CREDENTIALS FROM CLOUDINARY AND JSONBIN HERE
    const CLOUDINARY_CLOUD_NAME = "dhrjqsvmq";
    const CLOUDINARY_UPLOAD_PRESET = "art-galleryy";
    const JSONBIN_BIN_ID = "688de6db7b4b8670d8ab8d01";
    const JSONBIN_MASTER_KEY = "$2a$10$x0D0FLMMULUFTIwP/5fr6e872/fpmhPMbWDACvhkiZxVVwcc710ae";
    const ADMIN_PASSWORD = "admin123"; // You can change the admin password here

    // --- PART 2: SCRIPT STATE AND DOM ELEMENTS ---
    let isAdmin = false;
    let imageCache = [];
    const gallery = document.getElementById('gallery');
    const overlay = document.getElementById('fullscreenOverlay');
    const fullscreenImage = document.getElementById('fullscreenImage');

    // --- PART 3: CORE FUNCTIONS ---

    // Renders the entire gallery based on the current state
    function renderGallery() {
        gallery.innerHTML = '';
        imageCache.forEach(url => addImageToDOM(url));
        if (isAdmin) {
            enableUploadBox();
        }
    }

    // Creates a single image element and adds it to the page
    function addImageToDOM(url) {
      const wrapper = document.createElement('div');
      wrapper.className = 'image-wrapper';

      const img = document.createElement('img');
      img.src = url;
      img.alt = "Gallery Image";
      img.onclick = () => showFullscreen(url);
      wrapper.appendChild(img);

      if (isAdmin) {
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = "X";
        deleteBtn.className = "delete-btn";
        deleteBtn.title = "Delete Image";
        deleteBtn.onclick = (e) => {
            e.stopPropagation(); // Prevent fullscreen on click
            deleteImage(url);
        };
        wrapper.appendChild(deleteBtn);
      }
      gallery.appendChild(wrapper);
    }
    
    // Creates the '+' box for uploading files
    function enableUploadBox() {
        if (document.querySelector('.upload-box')) return;
        const box = document.createElement('div');
        box.className = 'upload-box';
        box.innerHTML = '<span>+</span>';
        gallery.appendChild(box);

        box.onclick = () => {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.onchange = () => handleFileUpload(fileInput.files[0], box);
            fileInput.click();
        };
    }

    // --- PART 4: ADMIN AND API FUNCTIONS ---

    // Checks password and enables admin mode
    function checkPassword() {
      const pass = document.getElementById("adminPass").value;
      if (pass === ADMIN_PASSWORD) {
        isAdmin = true;
        alert("Admin access granted!");
        document.querySelector('.admin-login').style.display = 'none';
        renderGallery();
      } else {
        alert("Wrong password!");
      }
    }

    // Handles the file upload process to Cloudinary
    async function handleFileUpload(file, uploadBox) {
        if (!file) return;
        uploadBox.innerHTML = '<span>...</span>'; // Show uploading feedback
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
        try {
            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                method: 'POST',
                body: formData
            });
            const data = await res.json();
            if (!data.secure_url) throw new Error('Upload failed.');
            
            imageCache.push(data.secure_url);
            await saveToJSONBin();
            renderGallery();
        } catch (error) {
            console.error("Upload failed:", error);
            alert("Upload failed. Check the console for details.");
            uploadBox.innerHTML = '<span>+</span>'; // Reset on failure
        }
    }

    // Deletes an image URL from the cache and saves the change
    async function deleteImage(urlToDelete) {
        if (!confirm('Are you sure you want to delete this image?')) return;
        imageCache = imageCache.filter(url => url !== urlToDelete);
        await saveToJSONBin();
        renderGallery();
    }
    
    // Saves the current imageCache array to your JSONBin
    async function saveToJSONBin() {
      try {
        await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": JSONBIN_MASTER_KEY,
          },
          body: JSON.stringify({ images: imageCache })
        });
      } catch (error) {
          console.error("Failed to save to JSONBin:", error);
          alert("Could not save gallery state.");
      }
    }

    // Loads the list of image URLs from your JSONBin on page load
    async function loadImagesFromJSONBin() {
      try {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
          headers: { "X-Master-Key": JSONBIN_MASTER_KEY }
        });
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        const data = await res.json();
        imageCache = data.record.images || [];
      } catch (err) {
        console.error("Could not load images from JSONBin:", err);
        imageCache = []; // Start with an empty gallery on error
      }
    }

    // --- PART 5: EVENT LISTENERS AND INITIALIZATION ---
    function showFullscreen(url) {
        fullscreenImage.src = url;
        overlay.classList.add('active');
    }

    overlay.onclick = () => {
      overlay.classList.remove('active');
      fullscreenImage.src = "";
    };

    // This is the main function that starts the app
    async function initializeApp() {
        await loadImagesFromJSONBin();
        renderGallery();
    }
    
    initializeApp();
  </script>
</body>
</html>